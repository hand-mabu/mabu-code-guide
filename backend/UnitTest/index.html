<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <title>单元测试 | MabuDoc Theme</title>
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <meta name="description" content="Modern, powerful and simple theme for Hexo.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/sukkaw/hexo-theme-suka@0.1.0/source/img/suka-favicon.ico">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/sukkaw/hexo-theme-suka@0.1.0/source/img/suka-favicon.ico">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spectre.css@0.5.3/dist/spectre.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spectre.css@0.5.3/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spectre.css@0.5.3/dist/spectre-icons.min.css">
    <link rel="stylesheet" href="/mabu-code-guide/style.min.css">
    <link rel="stylesheet" href="/mabu-code-guide/markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sukkaw/hexo-theme-suka@0.1.0/source/lib/prism/prism-ghcolors.min.css">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://hand-mabu.github.io/hexo-mabu-doc/">
    <meta property="og:title" content="介绍 | MabuDoc Theme">
    <meta property="og:description" content="Modern Simlpe Powerful Theme for hexo">
    <meta property="og:image" content>
</head>

<body>
    
<header class="pt-2 pb-2">
    <div class="container grid-lg navbar pt-2 pb-2">
        <section class="navbar-section">
            <a class="off-canvas-toggle btn btn-link btn-action" href="#sidebar"><i class="icon icon-menu"></i></a>
            <a class="navbar-icon" href="https://hand-mabu.github.io/hexo-mabu-doc/">
                <img src="/mabu-code-guide/assets/img/hexo-theme-suka.png">
            </a>
            <a href="https://hand-mabu.github.io/hexo-mabu-doc/" class="btn btn-link">
                MabuDoc Theme</a>
        </section>
        <section class="navbar-section">
            
            <a href="/mabu-code-guide/backend/UnitTest/" class="btn btn-link navbar-link">简体中文</a>
            
        </section>
    </div>
</header>

    <div class="off-canvas off-canvas-sidebar-show">

        <div id="sidebar" class="off-canvas-sidebar">
            

<div class="docs-nav">
    <div class="docs-search has-icon-left">
        <i class="form-icon icon icon-search"></i>
        <input id="search-field" class="form-input" type="text" placeholder="Search...">
    </div>
    <div id="search-result"></div>
    <ul class="nav">

<li class="nav-item" style>
    <a href="/mabu-code-guide/">
        MABU 代码规范
    </a>
</li>

<li class="nav-item" style>
    <a href="javascript:void(0);">
        前端
    </a>
</li><ul class="nav">

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/namingRules/">
        命名规则
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/HTML/">
        HTML
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/CSS_SCSS/">
        CSS SCSS
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/JavaScript/">
        JavaScript
    </a>
</li></ul>

<li class="nav-item" style>
    <a href="javascript:void(0);">
        后端
    </a>
</li><ul class="nav">

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/ProgramRules/">
        编程规约
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/ExceptionLog/">
        异常日志
    </a>
</li>

<li class="nav-item active" style>
    <a href="/mabu-code-guide/backend/UnitTest/">
        单元测试
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/SafetyRules/">
        安全规约
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/MysqlDatabase/">
        MYSQL数据库
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/EngineeringStructure/">
        工程结构
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/ProperNoun/">
        专有名词
    </a>
</li></ul>

<li class="nav-item" style>
    <a href="/mabu-code-guide/gitend/git/">
        Git
    </a>
</li></ul>
    <!-- <ul class="nav"> -->
    <!-- 
        <li class="nav-item">
            <a href="/mabu-code-guide/en/config/">Theme Config</a>
        </li>
    -->
    <!-- </ul> -->
</div>
        </div>

        <a class="off-canvas-overlay" href="#close"></a>

        <div class="off-canvas-content">
            <div class="container px-0">
                




<div class="docs-header">
    <div class="docs-header-wrapper">
        <div class="title-wrapper">
            <h1 class="docs-header-title mb-1">单元测试</h1>
            
        </div>
        <!-- <span class="label label-rounded bg-dark mt-2">
            <a class="docs-github" href="https://github.com/theme-suka/docs/tree/master/source/backend/UnitTest.md" target="_blank">在 GitHub 上编辑</a>
        </span> -->
    </div>
</div>

<div class="docs-content">
    <div class="columns">
        <div class="column col-9 col-lg-12 docs-content-section">
            <div class="container px-0">
                <div id="post-content">
                    <p>1.【强制】好的单元测试必须遵守 AIR 原则。<br>说明：单元测试在线上运行时，感觉像空气（AIR）一样并不存在，但在测试质量的保障上，却是非常关键的。好的单元测试宏观上来说，具有自动化、独立性、可重复执行的特点。</p>
<ul>
<li>A：<code>Automatic</code>（自动化）</li>
<li>I：<code>Independent</code>（独立性）</li>
<li>R：<code>Repeatable</code>（可重复）</li>
</ul>
<p>2.【强制】单元测试应该是全自动执行的，并且非交互式的。测试框架通常是定期执行的，执行过程必须完全自动化才有意义。输出结果需要人工检查的测试不是一个好的单元测试。单元测试中不准使用 <code>System.out</code> 来进行人肉验证，必须使用 <code>assert</code> 来验证。</p>
<p>3.【强制】保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间决不能互相调用，也不能依赖执行的先后次序。<br>反例：<code>method2</code> 需要依赖 <code>method1</code> 的执行，将执行结果做为 <code>method2</code> 的输入。</p>
<p>4.【强制】单元测试是可以重复执行的，不能受到外界环境的影响。<br>说明：单元测试通常会被放到持续集成中，每次有代码<code>check in</code> 时单元测试都会被执行。如果单测对外部环境（网络、服务、中间件等）有依赖，容易导致持续集成机制的不可用。<br>正例：为了不受外界环境影响，要求设计代码时就把 <code>SUT</code> 的依赖改成注入，在测试时用 <code>spring</code> 这样的 <code>DI</code> 框架注入一个本地（内存）实现或者 <code>Mock</code> 实现。</p>
<p>5.【强制】对于单元测试，要保证测试粒度足够小，有助于精确定位问题。单测粒度至多是类级别，一般是方法级别。<br>说明：只有测试粒度小才能在出错时尽快定位到出错位置。单测不负责检查跨类或者跨系统的交互逻辑，那是集成测试的领域。</p>
<p>6.【强制】核心业务、核心应用、核心模块的增量代码确保单元测试通过。<br>说明：新增代码及时补充单元测试，如果新增代码影响了原有单元测试，请及时修正。</p>
<p>7.【强制】单元测试代码必须写在如下工程目录：<code>src/test/java</code>，不允许写在业务代码目录下。<br>说明：源码构建时会跳过此目录，而单元测试框架默认是扫描此目录。</p>
<p>8.【推荐】单元测试的基本目标：语句覆盖率达到 70%；核心模块的语句覆盖率和分支覆盖率都要达到 100%。<br>说明：在工程规约的应用分层中提到的 <code>DAO</code> 层，<code>Manager</code> 层，可重用度高的 <code>Service</code>，都应该进行单元测试。</p>
<p>9.【推荐】编写单元测试代码遵守 <code>BCDE</code> 原则，以保证被测试模块的交付质量。</p>
<ul>
<li>B：<code>Border</code>，边界值测试，包括循环边界、特殊取值、特殊时间点、数据顺序等。</li>
<li>C：<code>Correct</code>，正确的输入，并得到预期的结果。</li>
<li>D：<code>Design</code>，与设计文档相结合，来编写单元测试。</li>
<li>E：<code>Error</code>，强制错误信息输入（如：非法数据、异常流程、非业务允许输入等），并得到预期的结果。</li>
</ul>
<p>10.【推荐】对于数据库相关的查询，更新，删除等操作，不能假设数据库里的数据是存在的，或者直接操作数据库把数据插入进去，请使用程序插入或者导入数据的方式来准备数据。<br>反例：删除某一行数据的单元测试，在数据库中，先直接手动增加一行作为删除目标，但是这一行新增数据并不符合业务插入规则，导致测试结果异常。</p>
<p>11.【推荐】和数据库相关的单元测试，可以设定自动回滚机制，不给数据库造成脏数据。或者<br>对单元测试产生的数据有明确的前后缀标识。<br>正例：在 <code>RDC</code> 内部单元测试中，使用 <code>RDC_UNIT_TEST_</code>的前缀标识数据。</p>
<p>12.【推荐】对于不可测的代码建议做必要的重构，使代码变得可测，避免为了达到测试要求而书写不规范测试代码。</p>
<p>13.【推荐】在设计评审阶段，开发人员需要和测试人员一起确定单元测试范围，单元测试最好覆盖所有测试用例（UC）。</p>
<p>14.【推荐】单元测试作为一种质量保障手段，不建议项目发布后补充单元测试用例，建议在项目提测前完成单元测试。</p>
<p>15.【参考】为了更方便地进行单元测试，业务代码应避免以下情况：</p>
<ul>
<li>构造方法中做的事情过多。</li>
<li>存在过多的全局变量和静态方法。</li>
<li>存在过多的外部依赖。</li>
<li>存在过多的条件语句。<br>说明：多层条件语句建议使用卫语句、策略模式、状态模式等方式重构。</li>
</ul>
<p>16.【参考】不要对单元测试存在如下误解：</p>
<ul>
<li>那是测试同学干的事情。本文是开发手册，凡是本文内容都是与开发同学强相关的。</li>
<li>单元测试代码是多余的。汽车的整体功能与各单元部件的测试正常与否是强相关的。</li>
<li>单元测试代码不需要维护。一年半载后，那么单元测试几乎处于废弃状态。</li>
<li>单元测试与线上故障没有辩证关系。好的单元测试能够最大限度地规避线上故障。</li>
</ul>

                </div>
            </div>
        </div>
        <div class="column col-3 hide-lg docs-toc-section">
            <div class="container px-0">
                <div id="post-toc">
                    
                </div>
            </div>
        </div>
    </div>
    <footer>
    <p class="mb-2"><a href="https://hand-mabu.github.io/mabu-code-guide/" target="_blank">Home</a> · <a href="https://github.com/hand-mabu/mabu-code-guide" target="_blank">GitHub</a>
    </p><p>Designed and built with by <a href="https://github.com/hand-mabu" target="_blank">MABU</a>. Licensed under the <a href="https://github.com/hand-mabu/mabu-code-guide/blob/dev/LICENSE" target="_blank">GPL V3 License</a>.</p>
</footer>
</div>

            </div>
        </div>
    </div>
    <script src="/mabu-code-guide/jquery.min.js"></script>
    <script src="/mabu-code-guide/index.js"></script>
    <script src="/mabu-code-guide/local-search.min.js"></script>
    <script>
        searchFunc('/mabu-code-guide/search.json')
    </script>
</body>

</html>