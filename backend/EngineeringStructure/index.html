<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <title>工程结构 | MabuDoc Theme</title>
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <meta name="description" content="Modern, powerful and simple theme for Hexo.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/sukkaw/hexo-theme-suka@0.1.0/source/img/suka-favicon.ico">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/sukkaw/hexo-theme-suka@0.1.0/source/img/suka-favicon.ico">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spectre.css@0.5.3/dist/spectre.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spectre.css@0.5.3/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spectre.css@0.5.3/dist/spectre-icons.min.css">
    <link rel="stylesheet" href="/mabu-code-guide/style.min.css">
    <link rel="stylesheet" href="/mabu-code-guide/markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sukkaw/hexo-theme-suka@0.1.0/source/lib/prism/prism-ghcolors.min.css">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://hand-mabu.github.io/hexo-mabu-doc/">
    <meta property="og:title" content="介绍 | MabuDoc Theme">
    <meta property="og:description" content="Modern Simlpe Powerful Theme for hexo">
    <meta property="og:image" content>
</head>

<body>
    
<header class="pt-2 pb-2">
    <div class="container grid-lg navbar pt-2 pb-2">
        <section class="navbar-section">
            <a class="off-canvas-toggle btn btn-link btn-action" href="#sidebar"><i class="icon icon-menu"></i></a>
            <a class="navbar-icon" href="https://hand-mabu.github.io/hexo-mabu-doc/">
                <img src="/mabu-code-guide/assets/img/hexo-theme-suka.png">
            </a>
            <a href="https://hand-mabu.github.io/hexo-mabu-doc/" class="btn btn-link">
                MabuDoc Theme</a>
        </section>
        <section class="navbar-section">
            
            <a href="/mabu-code-guide/backend/EngineeringStructure/" class="btn btn-link navbar-link">简体中文</a>
            
        </section>
    </div>
</header>

    <div class="off-canvas off-canvas-sidebar-show">

        <div id="sidebar" class="off-canvas-sidebar">
            

<div class="docs-nav">
    <div class="docs-search has-icon-left">
        <i class="form-icon icon icon-search"></i>
        <input id="search-field" class="form-input" type="text" placeholder="Search...">
    </div>
    <div id="search-result"></div>
    <ul class="nav">

<li class="nav-item" style>
    <a href="/mabu-code-guide/">
        MABU 代码规范
    </a>
</li>

<li class="nav-item" style>
    <a href="javascript:void(0);">
        前端
    </a>
</li><ul class="nav">

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/namingRules/">
        命名规则
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/HTML/">
        HTML
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/CSS_SCSS/">
        CSS SCSS
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/frontend/JavaScript/">
        JavaScript
    </a>
</li></ul>

<li class="nav-item" style>
    <a href="javascript:void(0);">
        后端
    </a>
</li><ul class="nav">

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/ProgramRules/">
        编程规约
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/ExceptionLog/">
        异常日志
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/UnitTest/">
        单元测试
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/SafetyRules/">
        安全规约
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/MysqlDatabase/">
        MYSQL数据库
    </a>
</li>

<li class="nav-item active" style>
    <a href="/mabu-code-guide/backend/EngineeringStructure/">
        工程结构
    </a>
</li>

<li class="nav-item" style>
    <a href="/mabu-code-guide/backend/ProperNoun/">
        专有名词
    </a>
</li></ul>

<li class="nav-item" style>
    <a href="/mabu-code-guide/gitend/git/">
        Git
    </a>
</li></ul>
    <!-- <ul class="nav"> -->
    <!-- 
        <li class="nav-item">
            <a href="/mabu-code-guide/en/config/">Theme Config</a>
        </li>
    -->
    <!-- </ul> -->
</div>
        </div>

        <a class="off-canvas-overlay" href="#close"></a>

        <div class="off-canvas-content">
            <div class="container px-0">
                




<div class="docs-header">
    <div class="docs-header-wrapper">
        <div class="title-wrapper">
            <h1 class="docs-header-title mb-1">工程结构</h1>
            
        </div>
        <!-- <span class="label label-rounded bg-dark mt-2">
            <a class="docs-github" href="https://github.com/theme-suka/docs/tree/master/source/backend/EngineeringStructure.md" target="_blank">在 GitHub 上编辑</a>
        </span> -->
    </div>
</div>

<div class="docs-content">
    <div class="columns">
        <div class="column col-9 col-lg-12 docs-content-section">
            <div class="container px-0">
                <div id="post-content">
                    <h1 id="一-应用分层"><a href="#一-应用分层" class="headerlink" title="一. 应用分层"></a>一. 应用分层</h1><p>1.【推荐】图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于 <code>Web</code> 层，也可以直接依赖于 <code>Service</code> 层，依此类推：</p>
<ul>
<li>开放接口层：可直接封装 <code>Service</code> 方法暴露成 RPC 接口；通过 <code>Web</code> 封装成 <code>http</code> 接口；进行网关安全控制、流量控制等。</li>
<li>终端显示层：各个端的模板渲染并执行显示的层。当前主要是 <code>velocity</code> 渲染，<code>JS</code> 渲染， <code>JSP</code> 渲染，移动端展示等。</li>
<li><code>Web</code> 层：主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。</li>
<li><code>Service</code> 层：相对具体的业务逻辑服务层。</li>
<li><code>Manager</code> 层：通用业务处理层，它有如下特征：<br>(1)对第三方平台封装的层，预处理返回结果及转化异常信息；<br>(2)对 <code>Service</code> 层通用能力的下沉，如缓存方案、中间件通用处理；<br>(3)与 <code>DAO</code> 层交互，对多个 <code>DAO</code> 的组合复用。</li>
<li><code>DAO</code> 层：数据访问层，与底层 <code>MySQL、Oracle、Hbase</code> 等进行数据交互。</li>
<li>外部接口或第三方平台：包括其它部门 <code>RPC</code> 开放接口，基础平台，其它公司的 <code>HTTP</code> 接口。</li>
</ul>
<p>2.【参考】 （分层异常处理规约）在 <code>DAO</code> 层，产生的异常类型有很多，无法用细粒度的异常进行 <code>catch</code>，使用 <code>catch(Exception e)</code>方式，并 <code>throw new DAOException(e)</code>，不需要打印日志，因为日志在 <code>Manager/Service</code> 层一定需要捕获并打到日志文件中去，如果同台服务器再打日志，浪费性能和存储。在 <code>Service</code> 层出现异常时，必须记录出错日志到磁盘，尽可能带上参数信息，相当于保护案发现场。如果 <code>Manager</code> 层与 <code>Service</code> 同机部署，日志方式与 <code>DAO</code>层处理一致，如果是单独部署，则采用与 <code>Service</code> 一致的处理方式。<code>Web</code> 层绝不应该继续往上抛异常，因为已经处于顶层，如果意识到这个异常将导致页面无法正常渲染，那么就应该直接跳转到友好错误页面，加上用户容易理解的错误提示信息。开放接口层要将异常处理成错误码和错误信息方式返回。</p>
<p>3.【参考】分层领域模型规约：</p>
<ul>
<li><code>DO（Data Object）</code>：与数据库表结构一一对应，通过 <code>DAO</code> 层向上传输数据源对象。</li>
<li><code>DTO（Data Transfer Object）</code>：数据传输对象，<code>Service</code> 或 <code>Manager</code> 向外传输的对象。</li>
<li><code>BO（Business Object）</code>：业务对象。由 <code>Service</code> 层输出的封装业务逻辑的对象。</li>
<li><code>AO（Application Object）</code>：应用对象。在 <code>Web</code> 层与 <code>Service</code> 层之间抽象的复用对象模型，极为贴近展示层，复用度不高。</li>
<li><code>VO（View Object）</code>：显示层对象，通常是 <code>Web</code> 向模板渲染引擎层传输的对象。</li>
<li><code>Query</code>：数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的查询封装，禁止使用 <code>Map</code> 类来传输。</li>
</ul>
<h1 id="二-二方库依赖"><a href="#二-二方库依赖" class="headerlink" title="二. 二方库依赖"></a>二. 二方库依赖</h1><p>1.【强制】定义 GAV 遵从以下规则：</p>
<ul>
<li>GroupID 格式：com.{公司/BU }.业务线.[子业务线]，最多 4 级。<br>说明：{公司/BU} 例如：<code>alibaba/taobao/tmall/aliexpress</code> 等 BU 一级；子业务线可选。<br>正例：<code>com.taobao.jstorm 或 com.alibaba.dubbo.register</code></li>
<li>ArtifactID 格式：产品线名-模块名。语义不重复不遗漏，先到中央仓库去查证一下。<br>正例：<code>dubbo-client / fastjson-api / jstorm-tool</code></li>
<li>Version：详细规定参考下方。</li>
</ul>
<p>2.【强制】二方库版本号命名方式：主版本号.次版本号.修订号</p>
<ul>
<li>主版本号：产品方向改变，或者大规模 API 不兼容，或者架构不兼容升级。</li>
<li>次版本号：保持相对兼容性，增加主要功能特性，影响范围极小的 API 不兼容修改。</li>
<li>修订号：保持完全兼容性，修复 BUG、新增次要功能特性等。<br>说明：注意起始版本号必须为：1.0.0，而不是 0.0.1    正式发布的类库必须先去中央仓库进行查证，使版本号有延续性，正式版本号不允许覆盖升级。如当前版本：1.3.3，那么下一个合理的版本号：1.3.4 或 1.4.0 或 2.0.0</li>
</ul>
<p>3.【强制】线上应用不要依赖 SNAPSHOT 版本（安全包除外）。<br>说明：不依赖 SNAPSHOT 版本是保证应用发布的幂等性。另外，也可以加快编译时的打包构建。</p>
<p>4.【强制】二方库的新增或升级，保持除功能点之外的其它 jar 包仲裁结果不变。如果有改变，必须明确评估和验证，建议进行 <code>dependency:resolve</code> 前后信息比对，如果仲裁结果完全不一致，那么通过 <code>dependency:tree</code> 命令，找出差异点，进行<excludes>排除 jar 包。</excludes></p>
<p>5.【强制】二方库里可以定义枚举类型，参数可以使用枚举类型，但是接口返回值不允许使用枚举类型或者包含枚举类型的 <code>POJO</code> 对象。</p>
<p>6.【强制】依赖于一个二方库群时，必须定义一个统一的版本变量，避免版本号不一致。<br>说明：依赖 <code>springframework-core,-context,-beans</code>，它们都是同一个版本，可以定义一个变量来保存版本：<code>${spring.version}</code>，定义依赖的时候，引用该版本。</p>
<p>7.【强制】禁止在子项目的 <code>pom</code> 依赖中出现相同的 <code>GroupId</code>，相同的 <code>ArtifactId</code>，但是不同的<code>Version</code>。<br>说明：在本地调试时会使用各子项目指定的版本号，但是合并成一个 <code>war</code>，只能有一个版本号出现在最后的 <code>lib</code> 目录中。可能出现线下调试是正确的，发布到线上却出故障的问题。</p>
<p>8.【推荐】所有 <code>pom</code> 文件中的依赖声明放在<code>&lt;dependencies&gt;</code>语句块中，所有版本仲裁放在<code>&lt;dependencyManagement&gt;</code>语句块中。<br>说明：<code>&lt;dependencyManagement&gt;</code>里只是声明版本，并不实现引入，因此子项目需要显式的声明依赖，<code>version</code> 和 <code>scope</code> 都读取自父 <code>pom</code>。而<code>&lt;dependencies&gt;</code>所有声明在主 <code>pom</code> 的<code>&lt;dependencies&gt;</code>里的依赖都会自动引入，并默认被所有的子项目继承。</p>
<p>9.【推荐】二方库不要有配置项，最低限度不要再增加配置项。</p>
<p>10.【参考】为避免应用二方库的依赖冲突问题，二方库发布者应当遵循以下原则：</p>
<ul>
<li>精简可控原则。移除一切不必要的<code>API</code> 和依赖，只包含 <code>Service API</code>、必要的领域模型对象、<code>Utils</code>类、常量、枚举等。如果依赖其它二方库，尽量是 <code>provided</code> 引入，让二方库使用者去依赖具体版本号；无 <code>log</code> 具体实现，只依赖日志框架。</li>
<li>稳定可追溯原则。每个版本的变化应该被记录，二方库由谁维护，源码在哪里，都需要能方便查到。除非用户主动升级版本，否则公共二方库的行为不应该发生变化。</li>
</ul>
<h1 id="三-服务器"><a href="#三-服务器" class="headerlink" title="三. 服务器"></a>三. 服务器</h1><p>1.【推荐】高并发服务器建议调小 <code>TCP</code> 协议的 <code>time_wait</code> 超时时间。<br>说明：操作系统默认 240 秒后，才会关闭处于 <code>time_wait</code> 状态的连接，在高并发访问下，服务器端会因为处于<code>time_wait</code> 的连接数太多，可能无法建立新的连接，所以需要在服务器上调小此等待值。<br>正例：在 <code>linux</code> 服务器上请通过变更<code>/etc/sysctl.conf</code> 文件去修改该缺省值（秒）：<code>net.ipv4.tcp_fin_timeout = 30</code></p>
<p>2.【推荐】调大服务器所支持的最大文件句柄数（File Descriptor，简写为 fd）。<br>说明：主流操作系统的设计是将 <code>TCP/UDP</code> 连接采用与文件一样的方式去管理，即一个连接对应于一个 fd。主流的 <code>linux</code> 服务器默认所支持最大 fd 数量为 1024，当并发连接数很大时很容易因为 fd 不足而出现“open too many files”错误，导致新的连接无法建立。 建议将 <code>linux</code> 服务器所支持的最大句柄数调高数倍（与服务器的内存数量相关）。</p>
<p>3.【推荐】给 <code>JVM</code> 设置<code>-XX:+HeapDumpOnOutOfMemoryError</code> 参数，让 <code>JVM</code> 碰到 <code>OOM</code> 场景时输出<code>dump</code> 信息。<br>说明：<code>OOM</code> 的发生是有概率的，甚至有规律地相隔数月才出现一例，出现时的现场信息对查错非常有价值。</p>
<p>4.【推荐】在线上生产环境，<code>JVM</code> 的 <code>Xms</code> 和 <code>Xmx</code> 设置一样大小的内存容量，避免在 <code>GC</code> 后调整堆大小带来的压力。</p>
<p>5.【参考】服务器内部重定向使用 <code>forward</code>；外部重定向地址使用 <code>URL</code> 拼装工具类来生成，否则会带来 <code>URL</code> 维护不一致的问题和潜在的安全风险。</p>

                </div>
            </div>
        </div>
        <div class="column col-3 hide-lg docs-toc-section">
            <div class="container px-0">
                <div id="post-toc">
                    
                        <p class="h4 text-bold">目录</p>
                        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一-应用分层"><span class="post-toc-text">一. 应用分层</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#二-二方库依赖"><span class="post-toc-text">二. 二方库依赖</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#三-服务器"><span class="post-toc-text">三. 服务器</span></a></li></ol>
                    
                </div>
            </div>
        </div>
    </div>
    <footer>
    <p class="mb-2"><a href="https://hand-mabu.github.io/mabu-code-guide/" target="_blank">Home</a> · <a href="https://github.com/hand-mabu/mabu-code-guide" target="_blank">GitHub</a>
    </p><p>Designed and built with by <a href="https://github.com/hand-mabu" target="_blank">MABU</a>. Licensed under the <a href="https://github.com/hand-mabu/mabu-code-guide/blob/dev/LICENSE" target="_blank">GPL V3 License</a>.</p>
</footer>
</div>

            </div>
        </div>
    </div>
    <script src="/mabu-code-guide/jquery.min.js"></script>
    <script src="/mabu-code-guide/index.js"></script>
    <script src="/mabu-code-guide/local-search.min.js"></script>
    <script>
        searchFunc('/mabu-code-guide/search.json')
    </script>
</body>

</html>